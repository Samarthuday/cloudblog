<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - BlogDash</title>
  <meta name="description" content="Log in to your CloudBlog account to manage your blogs and publish new content.">
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="../auth/auth.css">
  <link rel="icon" href="../assets/favicon/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>
  
  <!-- Initialize Firebase -->
  <script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyB1FMx76cBLz8LZq8-ai765u2mV-caQQZg",
        authDomain: "cloudblog-12cb8.firebaseapp.com",
        databaseURL: "https://cloudblog-12cb8-default-rtdb.firebaseio.com",
        projectId: "cloudblog-12cb8",
        storageBucket: "cloudblog-12cb8.appspot.com",
        messagingSenderId: "632917097509",
        appId: "1:632917097509:web:35791d6861771bd3fc93cc",
        measurementId: "G-4DFB318NC2"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
  </script>
</head>

<body class="auth-page">
  <nav class="navbar">
    <div class="nav-content">
      <a href="../admin/index.html" class="logo">
        <img src="../assests/images/feather-wing-svgrepo-com.svg" alt="CloudBlog Logo" class="logo-img">
        <span>BlogDash</span>
      </a>
      <div class="nav-links">
        <a href="../admin/index.html">Home</a>
        <a href="../admin/index.html#features-section">Features</a>
        <a href="../admin/index.html#pricing-section">Pricing</a>
        <!--<a href="../blog">Blog</a>-->
        <a href="../pages/blog-templates.html">Templates</a>
        <a href="../pages/support.html">Support</a>
      </div>
      <div class="auth-buttons">
        <button class="theme-toggle" aria-label="Toggle dark mode">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="theme-icon">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 17.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zm0 1.5a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm12-7a.8.8 0 0 1-.8.8h-2.4a.8.8 0 0 1 0-1.6h2.4a.8.8 0 0 1 .8.8zM4 12a.8.8 0 0 1-.8.8H.8a.8.8 0 0 1 0-1.6h2.5a.8.8 0 0 1 .8.8zm16.5-8.5a.8.8 0 0 1 0 1.1l-1.8 1.8a.8.8 0 0 1-1.1-1.1l1.8-1.8a.8.8 0 0 1 1.1 0zM6.3 17.7a.8.8 0 0 1 0 1.1l-1.8 1.8a.8.8 0 0 1-1.1-1.1l1.8-1.8a.8.8 0 0 1 1.1 0zM12 0a.8.8 0 0 1 .8.8v2.5a.8.8 0 0 1-1.6 0V.8A.8.8 0 0 1 12 0zm0 20a.8.8 0 0 1 .8.8v2.4a.8.8 0 0 1-1.6 0v-2.4a.8.8 0 0 1 .8-.8zM3.5 3.5a.8.8 0 0 1 1.1 0l1.8 1.8a.8.8 0 1 1-1.1 1.1L3.5 4.6a.8.8 0 0 1 0-1.1zm14.2 14.2a.8.8 0 0 1 1.1 0l1.8 1.8a.8.8 0 0 1-1.1 1.1l-1.8-1.8a.8.8 0 0 1 0-1.1z"/>
          </svg>
        </button>
        <a href="login.html" class="btn btn-text active">Log In</a>
        <a href="register.html" class="btn btn-primary">Sign Up Free</a>
      </div>
    </div>
  </nav>

  <main class="auth-container">
    <div class="auth-card">
      <div class="auth-header">
        <h1>Welcome Back</h1>
        <p>Sign in to continue to CloudBlog</p>
      </div>

      <form id="login-form" class="auth-form">
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" required>
          <span class="error-message" id="email-error"></span>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="password-input-container">
            <input type="password" id="password" name="password" required>
            <button type="button" class="toggle-password" aria-label="Toggle password visibility">
              <i class="far fa-eye"></i>
            </button>
          </div>
          <span class="error-message" id="password-error"></span>
        </div>

        <div class="form-group">
          <div class="remember-forgot">
            <label class="remember-me">
              <input type="checkbox" name="remember">
              Remember me
            </label>
            <a href="reset-password.html" class="forgot-password">Forgot Password?</a>
          </div>
        </div>

        <div class="form-group">
          <button type="submit" class="btn btn-primary btn-block">Sign In</button>
        </div>

        <div class="auth-message error-message" id="login-error"></div>
        <div class="auth-message success-message" id="login-success"></div>
      </form>

      <div class="auth-footer">
        <p>Don't have an account? <a href="register.html">Sign up</a></p>
      </div>
    </div>
  </main>

  <footer id="site-footer"></footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const loginForm = document.getElementById('login-form');
        const emailError = document.getElementById('email-error');
        const passwordError = document.getElementById('password-error');
        const loginError = document.getElementById('login-error');
        const loginSuccess = document.getElementById('login-success');

        // Password toggle functionality
        const togglePassword = document.querySelector('.toggle-password');
        const passwordInput = document.getElementById('password');

        if (togglePassword && passwordInput) {
            togglePassword.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                const icon = this.querySelector('i');
                icon.classList.toggle('fa-eye');
                icon.classList.toggle('fa-eye-slash');
            });
        }

        // Form submission
        if (loginForm) {
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();

                // Clear previous errors
                emailError.textContent = '';
                passwordError.textContent = '';
                loginError.textContent = '';
                loginSuccess.textContent = '';

                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;

                // Basic validation
                let isValid = true;

                if (!email) {
                    emailError.textContent = 'Email is required';
                    isValid = false;
                } else if (!isValidEmail(email)) {
                    emailError.textContent = 'Please enter a valid email address';
                    isValid = false;
                }

                if (!password) {
                    passwordError.textContent = 'Password is required';
                    isValid = false;
                }

                if (!isValid) return;

                // Disable submit button and show loading state
                const submitButton = loginForm.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.textContent;
                submitButton.disabled = true;
                submitButton.textContent = 'Signing in...';

                try {
                    const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                    console.log('Login successful:', userCredential.user.uid);
                    
                    loginSuccess.textContent = 'Login successful! Redirecting...';
                    loginSuccess.style.display = 'block';

                    // Check for pending comment or return URL
                    const pendingComment = localStorage.getItem('pendingComment');
                    const returnUrl = localStorage.getItem('returnUrl');
                    
                    // Redirect to appropriate page
                    setTimeout(() => {
                        if (returnUrl) {
                            localStorage.removeItem('returnUrl');
                            window.location.href = returnUrl;
                        } else {
                            window.location.href = '../dashboard/dashboard.html';
                        }
                    }, 1000);
                } catch (error) {
                    console.error('Login error:', error);
                    loginError.textContent = getErrorMessage(error.code);
                    loginError.style.display = 'block';
                    submitButton.disabled = false;
                    submitButton.textContent = originalButtonText;
                }
            });
        }

        // Helper functions
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email.toLowerCase());
        }

        function getErrorMessage(errorCode) {
            switch (errorCode) {
                case 'auth/user-not-found':
                case 'auth/wrong-password':
                    return 'Invalid email or password';
                case 'auth/too-many-requests':
                    return 'Too many failed attempts. Please try again later';
                case 'auth/user-disabled':
                    return 'This account has been disabled';
                default:
                    return 'An error occurred. Please try again';
            }
        }

        // Theme toggle functionality
        const themeToggle = document.querySelector('.theme-toggle');
        const themeIcon = themeToggle.querySelector('.theme-icon');
        
        // Check for saved theme preference
        const savedTheme = localStorage.getItem('login-theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        // Set initial icon based on saved theme
        themeIcon.innerHTML = savedTheme === 'light' 
            ? '<path fill-rule="evenodd" clip-rule="evenodd" d="M12 17.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zm0 1.5a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm12-7a.8.8 0 0 1-.8.8h-2.4a.8.8 0 0 1 0-1.6h2.4a.8.8 0 0 1 .8.8zM4 12a.8.8 0 0 1-.8.8H.8a.8.8 0 0 1 0-1.6h2.5a.8.8 0 0 1 .8.8zm16.5-8.5a.8.8 0 0 1 0 1.1l-1.8 1.8a.8.8 0 0 1-1.1-1.1l1.8-1.8a.8.8 0 0 1 1.1 0zM6.3 17.7a.8.8 0 0 1 0 1.1l-1.8 1.8a.8.8 0 0 1-1.1-1.1l1.8-1.8a.8.8 0 0 1 1.1 0zM12 0a.8.8 0 0 1 .8.8v2.5a.8.8 0 0 1-1.6 0V.8A.8.8 0 0 1 12 0zm0 20a.8.8 0 0 1 .8.8v2.4a.8.8 0 0 1-1.6 0v-2.4a.8.8 0 0 1 .8-.8zM3.5 3.5a.8.8 0 0 1 1.1 0l1.8 1.8a.8.8 0 1 1-1.1 1.1L3.5 4.6a.8.8 0 0 1 0-1.1zm14.2 14.2a.8.8 0 0 1 1.1 0l1.8 1.8a.8.8 0 0 1-1.1 1.1l-1.8-1.8a.8.8 0 0 1 0-1.1z"/>'
            : '<path fill-rule="evenodd" clip-rule="evenodd" d="M12.1 22c-5.5 0-10-4.5-10-10s4.5-10 10-10c1.8 0 3.5.5 5 1.3-3.2 1-5.5 4-5.5 7.5s2.3 6.5 5.5 7.5c-1.5.8-3.2 1.3-5 1.3zm-7-10c0 3.9 3.1 7 7 7s7-3.1 7-7-3.1-7-7-7-7 3.1-7 7z"/>';
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('login-theme', newTheme);
            
            // Update icon
            themeIcon.innerHTML = newTheme === 'light' 
                ? '<path fill-rule="evenodd" clip-rule="evenodd" d="M12 17.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zm0 1.5a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm12-7a.8.8 0 0 1-.8.8h-2.4a.8.8 0 0 1 0-1.6h2.4a.8.8 0 0 1 .8.8zM4 12a.8.8 0 0 1-.8.8H.8a.8.8 0 0 1 0-1.6h2.5a.8.8 0 0 1 .8.8zm16.5-8.5a.8.8 0 0 1 0 1.1l-1.8 1.8a.8.8 0 0 1-1.1-1.1l1.8-1.8a.8.8 0 0 1 1.1 0zM6.3 17.7a.8.8 0 0 1 0 1.1l-1.8 1.8a.8.8 0 0 1-1.1-1.1l1.8-1.8a.8.8 0 0 1 1.1 0zM12 0a.8.8 0 0 1 .8.8v2.5a.8.8 0 0 1-1.6 0V.8A.8.8 0 0 1 12 0zm0 20a.8.8 0 0 1 .8.8v2.4a.8.8 0 0 1-1.6 0v-2.4a.8.8 0 0 1 .8-.8zM3.5 3.5a.8.8 0 0 1 1.1 0l1.8 1.8a.8.8 0 1 1-1.1 1.1L3.5 4.6a.8.8 0 0 1 0-1.1zm14.2 14.2a.8.8 0 0 1 1.1 0l1.8 1.8a.8.8 0 0 1-1.1 1.1l-1.8-1.8a.8.8 0 0 1 0-1.1z"/>'
                : '<path fill-rule="evenodd" clip-rule="evenodd" d="M12.1 22c-5.5 0-10-4.5-10-10s4.5-10 10-10c1.8 0 3.5.5 5 1.3-3.2 1-5.5 4-5.5 7.5s2.3 6.5 5.5 7.5c-1.5.8-3.2 1.3-5 1.3zm-7-10c0 3.9 3.1 7 7 7s7-3.1 7-7-3.1-7-7-7-7 3.1-7 7z"/>';
        });
    });
  </script>
</body>

</html>
